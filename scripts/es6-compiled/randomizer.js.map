{"version":3,"sources":["../es6/randomizer.js"],"names":[],"mappings":"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","file":"randomizer.js","sourcesContent":["class Randomizer {\n\n\tstatic rand(min, max, allowFloats) {\n\t\tif (min === undefined ||Number.isNaN(min) || max === undefined || Number.isNaN(max)) return undefined;\n\n\t\tif (allowFloats)\n\t\t\treturn min + (Math.random() * (max-min));\n\t\telse\n\t\t\treturn min + Math.floor(Math.random() * (max-min+1));\n\t}\n\n\tstatic pickWeightedRandom(choices) {\n\t\tvar ret = undefined;\n\t\tchoices = $.extend(true, [], choices);\n\t\tif (choices.length === 1) ret = choices[0];\n\t\telse {\n\t\t\tvar currentCumSum = 0;\n\t\t\tchoices.forEach(function(c){\n\t\t\t\tUtils.assert(c.hasOwnProperty(\"weight\"),\n\t\t\t\t\t`Invalid parameter format - each object in array needs a weight. (${JSON.stringify(choices)})`);\n\t\t\t\tcurrentCumSum += c.weight;\n\t\t\t\tc.cumSum = currentCumSum;\n\t\t\t});\n\t\t\tvar r = Randomizer.rand(0,currentCumSum, true); // TODO this is inaccurate\n\t\t\tchoices.forEach(function(c, i){\n\t\t\t\tif (r < c.cumSum && !ret) ret = choices[i];\n\t\t\t});\n\t\t\tdelete ret.cumSum;\n\t\t}\n\t\treturn ret;\n\t} //test\n\n\tstatic genSingleChoiceTile(diff, group, mainNumber) {\n\n\t\tmainNumber = +mainNumber;\n\n\t\tvar choice = Randomizer.getRandomTileData(diff);\n\n\t\tvar reRoll = () => Randomizer.getRandomTileData(diff);\n\n\t\tvar count = function(id) {\n\t\t\tlet count = 0;\n\t\t\tgroup.choices.forEach(c => { count += c.id === id });\n\t\t\treturn count;\n\t\t};\n\n\t\tvar scope = () => ({\n\t\t\tmainNumber,\n\t\t\tme: choice.value,\n\t\t\tmyCount: count(choice.id),\n\t\t\tvalueSoFar: group.totalValue,\n\t\t\tmyIndex: group.choices.length,\n\t\t\tfinalIndex: group.registry.choiceTileCount\n\t\t});\n\n\t\twhile (choice.condition !== undefined && false === math.eval(choice.condition, scope())) {\n\t\t\tchoice = reRoll();\n\t\t}\n\t\twhile (choice.retryCondition !== undefined && math.eval(choice.retryCondition, scope()) ) {\n\t\t\tchoice.randomize();\n\t\t}\n\t\treturn choice;\n\t}\n\n\tstatic getRandomTileData(difficulty, isMain=false) { // this pulls from difficulty.js\n\n\t\tUtils.assert(typeof difficulty === \"number\" && DIFFICULTY_DATA[difficulty] !== undefined,\n\t\t\t`Invalid difficulty: ${difficulty}`);\n\n\t\tvar choices = DIFFICULTY_DATA[difficulty][isMain ? \"main\" : \"choices\"];\n\n\t\tvar rand = Randomizer.pickWeightedRandom(choices);\n\t\tvar choice = new RandomChoice(rand);\n\t\tchoice.randomize();\n\n\t\treturn choice;\n\t}\n}\n\nclass RandomChoice {\n\tconstructor(choice) {\n\t\tthis.value = undefined;\n\t\tthis.condition = choice.condition;\n\t\tthis.retryCondition = choice.retryCondition;\n\t\tthis.choice = choice;\n\t}\n\n\tget valueString() {\n\t\treturn [this.choice.operation, this.value].join(\" \");\n\t}\n\n\ttoTile(parentSel) {\n\t\treturn new Tile(this.valueString, parentSel);\n\t}\n\n\tget operation() {\n\t\treturn this.toTile().operation;\n\t}\n\n\trandomize() {\n\t\tswitch (this.choice.type) {\n\t\t\tcase \"integer\":\n\t\t\t\tthis.value = Utils.rand(...this.choice.limits);\n\t\t\t\tbreak;\n\t\t\tcase \"fraction\":\n\t\t\t\tthis.value = Utils.buildFraction(\n\t\t\t\t\tRandomizer.rand(...(this.choice.numeratorLimits || [NaN])),\n\t\t\t\t\tRandomizer.rand(...(this.choice.denominatorLimits || NaN)),\n\t\t\t\t\tRandomizer.rand(...(this.choice.resultLimits || [NaN]))\n\t\t\t\t).toString();\n\t\t\t\tbreak;\n\t\t\tcase \"power\":\n\t\t\tcase \"exponent\":\n\t\t\t\tthis.value = `${Randomizer.rand(...this.choice.baseLimits)} ^ ${this.choice.power ||\n\t\t\t\tRandomizer.rand(...this.choice.powerLimits)}`;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.value = NaN;\n\t\t}\n\t}\n}"]}